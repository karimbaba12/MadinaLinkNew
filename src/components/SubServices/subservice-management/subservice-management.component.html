<div class="subservice-management-container">
    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- CRUD Table -->
    <app-reusable-crud [config]="config" [isLoading]="isLoading" [rowActionsTemplate]="rowActions" [showSearch]="true"
        (add)="openAddEditDialog()" (edit)="openAddEditDialog(true, $event)" (delete)="confirmDelete($event)"
        (refresh)="loadSubServices()">
        <ng-template #rowActions let-item>
            <button mat-icon-button class="edit" (click)="openAddEditDialog(true, item); $event.stopPropagation()">
                <mat-icon color="primary">edit</mat-icon>
            </button>
            <button mat-icon-button class="delete" (click)="confirmDelete(item); $event.stopPropagation()">
                <mat-icon color="warn">delete</mat-icon>
            </button>
        </ng-template>
    </app-reusable-crud>

    <!-- Add/Edit Dialog -->
    <div *ngIf="displayDialog" class="dialog-overlay">
        <mat-card class="dialog-card">
            <mat-card-header>
                <mat-card-title>{{ isEditMode ? 'Edit Sub-Service' : 'Add New Sub-Service' }}</mat-card-title>
                <button mat-icon-button class="close-button" (click)="closeDialog()">
                    <mat-icon>close</mat-icon>
                </button>
            </mat-card-header>

            <mat-card-content>
                <form [formGroup]="subServiceForm" (ngSubmit)="onSubmit()" class="dialog-form">
                    <div class="form-grid">
                        <!-- Service -->
                        <mat-form-field appearance="outline" class="field">
                            <mat-label>Service *</mat-label>
                            <mat-select formControlName="serviceId">
                                <mat-option *ngFor="let service of services" [value]="service.serviceId">
                                    {{ service.serviceName }}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="subServiceForm.get('serviceId')?.invalid">Please select a
                                service</mat-error>
                        </mat-form-field>

                        <!-- Subscription Type -->
                        <mat-form-field appearance="outline" class="field">
                            <mat-label>Subscription Type *</mat-label>
                            <mat-select formControlName="subscriptionTypeId">
                                <mat-option *ngFor="let type of subscriptionTypes" [value]="type.subscriptionTypeId">
                                    {{ type.subscriptionTypeName }}
                                </mat-option>
                            </mat-select>
                            <mat-error *ngIf="subServiceForm.get('subscriptionTypeId')?.invalid">Please select a
                                subscription type</mat-error>
                        </mat-form-field>

                        <!-- Sub-Service Code -->
                        <mat-form-field appearance="outline" class="field">
                            <mat-label>Sub-Service Code *</mat-label>
                            <input matInput formControlName="subServiceCode" maxlength="20" />
                            <mat-error *ngIf="subServiceForm.get('subServiceCode')?.invalid">
                                <ng-container
                                    *ngIf="subServiceForm.get('subServiceCode')?.errors?.['required']">Required</ng-container>
                                <ng-container *ngIf="subServiceForm.get('subServiceCode')?.errors?.['maxlength']">Max 20
                                    chars</ng-container>
                            </mat-error>
                        </mat-form-field>

                        <!-- Sub-Service Name -->
                        <mat-form-field appearance="outline" class="field">
                            <mat-label>Sub-Service Name *</mat-label>
                            <input matInput formControlName="subServiceName" maxlength="100" />
                            <mat-error *ngIf="subServiceForm.get('subServiceName')?.invalid">
                                <ng-container
                                    *ngIf="subServiceForm.get('subServiceName')?.errors?.['required']">Required</ng-container>
                                <ng-container *ngIf="subServiceForm.get('subServiceName')?.errors?.['maxlength']">Max
                                    100 chars</ng-container>
                            </mat-error>
                        </mat-form-field>


                        <!-- Price -->
                        <mat-form-field appearance="outline" class="field">
                            <mat-label>Price *</mat-label>
                            <input matInput type="number" formControlName="price" min="0" step="0.01" />
                            <span matPrefix>$&nbsp;</span>
                            <mat-error *ngIf="subServiceForm.get('price')?.invalid">
                                <ng-container
                                    *ngIf="subServiceForm.get('price')?.errors?.['required']">Required</ng-container>
                                <ng-container *ngIf="subServiceForm.get('price')?.errors?.['min']">Cannot be
                                    negative</ng-container>
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div class="dialog-actions">
                        <button mat-button type="button" (click)="closeDialog()" [disabled]="isLoading">Cancel</button>
                        <button mat-raised-button color="primary" type="submit"
                            [disabled]="subServiceForm.invalid || isLoading">
                            {{ isEditMode ? 'Update' : 'Save' }}
                            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                        </button>
                    </div>
                </form>
            </mat-card-content>
        </mat-card>
    </div>

  
</div>
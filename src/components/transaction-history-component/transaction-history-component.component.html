<!-- transaction-history.component.html -->
<div class="transaction-container">
    <div class="summary-cards">
        <mat-card class="summary-card">
            <mat-card-header>
                <mat-card-title>Daily Transactions</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="summary-value">{{dailyCount}}</div>
            </mat-card-content>
        </mat-card>

        <mat-card class="summary-card">
            <mat-card-header>
                <mat-card-title>Monthly Transactions</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="summary-value">{{monthlyCount}}</div>
            </mat-card-content>
        </mat-card>

        <mat-card class="summary-card profit-card">
            <mat-card-header>
                <mat-card-title>Today's Profit</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="summary-value">{{dailyProfit | currency}}</div>
            </mat-card-content>
        </mat-card>
    </div>

    <mat-card class="transaction-card">
        <mat-card-header class="d-flex justify-content-between">
            <mat-card-title>
                {{showDailyOnly ? 'Daily' : 'All'}} Transactions
            </mat-card-title>
            <mat-card-actions>
                <button mat-raised-button color="primary" class="btn btn-success" (click)="toggleView()">
                    {{showDailyOnly ? 'Show All Transactions' : 'Show Daily Only'}}
                </button>
            </mat-card-actions>
        </mat-card-header>

        <mat-card-content>
            <div class="search-container">
                <mat-form-field appearance="outline" class="search-field w-100">
                    <mat-label>Search by name</mat-label>
                    <input matInput [formControl]="searchControl" placeholder="Enter user name">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
            </div>

                <div class="table-container" *ngIf="!isLoading; else loading">
                    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
                        <!-- Transaction ID Column -->
                        <ng-container matColumnDef="transactionId">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                            <td mat-cell *matCellDef="let row">{{row.transactionId}}</td>
                        </ng-container>

                        <!-- User Column -->
                    
                                <ng-container matColumnDef="userName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>User</th>
                            <td mat-cell *matCellDef="let row">
                                {{ getUserName(row.userId) | async }}
                            </td>
                        </ng-container>
                        <ng-template #loading>
                            <mat-spinner diameter="20" class="inline-spinner"></mat-spinner>
                        </ng-template>
            




                        <!-- Credit Column -->
                        <ng-container matColumnDef="credit">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Credit</th>
                            <td mat-cell *matCellDef="let row" [class.positive]="row.credit > 0">
                                {{row.credit | currency}}
                            </td>
                        </ng-container>

                        <!-- Debit Column -->
                        <ng-container matColumnDef="debit">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Debit</th>
                            <td mat-cell *matCellDef="let row" [class.negative]="row.debit > 0">
                                {{row.debit | currency}}
                            </td>
                        </ng-container>

                        <!-- Date Column -->
                        <ng-container matColumnDef="createdAt">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
                            <td mat-cell *matCellDef="let row">{{formatDate(row.createdAt)}}</td>
                        </ng-container>

                        <!-- Actions Column -->
                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>Actions</th>
                            <td mat-cell *matCellDef="let row">
                                <app-transaction-actions [transaction]="row" (onEdit)="handleEdit($event)"
                                    (onDelete)="handleDelete($event)" >
                                </app-transaction-actions>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>

                    <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
                </div>

            <ng-template #loading>
                <div class="loading-spinner">
                    <mat-spinner diameter="50"></mat-spinner>
                    <p>Loading transactions...</p>
                </div>
            </ng-template>
        </mat-card-content>
    </mat-card>
</div>
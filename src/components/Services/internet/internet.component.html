<div class="container">
    <div class="subscription-card">
        <h2 class="card-title">
            üåê {{ selectedSubscriptionId ? 'Update' : 'Create' }} Internet Subscription
        </h2>

        <form [formGroup]="subscriptionForm" (ngSubmit)="submit()" class="subscription-form">
            <div class="form-grid  ">

                <div class="form-group">
                    <label for="subServiceId">Subservice</label>
                    <select id="subServiceId" formControlName="subServiceId" class="form-control">
                        <option value="">Select a subservice</option>
                        <option *ngFor="let service of subServices" [value]="service.subServiceId">
                            {{ service.subServiceName }} ({{ service.subServiceCode }})
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="discount">Discount (%)</label>
                    <input type="number" id="discount" formControlName="discount" min="0" max="100"
                        class="form-control" />
                </div>
                <div class="form-group">
                    <label for="quantity">Qantity</label>
                    <input type="number" id="quantity" formControlName="quantity" min="0" max="100"
                        class="form-control" />
                </div>

                <div class="form-group price-display">
                    <div class="calculated-price">
                        <span class="price-label">Calculated Price:</span>
                        <span class="price-value">{{ calculatedPrice | number: '1.2-2' }} USD</span>
                        <span *ngIf="!subscriptionForm.get('subServiceId')?.value" class="price-hint">
                            (Select a subservice to see price)
                        </span>
                    </div>
                </div>

                <div class="form-group toggle-group">
                    <label for="isActive">Status</label>
                    <mat-slide-toggle formControlName="isActive" id="isActive" color="primary">
                        {{ subscriptionForm.get('isActive')?.value ? 'Active' : 'Inactive' }}
                    </mat-slide-toggle>
                </div>
            </div>

            <div class="action-buttons">
                <button type="submit" class="btn btn-primary action-btn"
                    [disabled]="isLoading || subscriptionForm.invalid" [class.loading]="isLoading">
                    <span *ngIf="!isLoading">
                        {{ selectedSubscriptionId ? 'Update Subscription' : 'Create Subscription' }}
                    </span>
                    <span *ngIf="isLoading" class="spinner"></span>
                </button>

                <div class="secondary-actions">
                    <button *ngIf="selectedSubscriptionId" type="button" class="btn btn-danger action-btn"
                        (click)="confirmDelete()" [disabled]="isLoading">
                        Delete Subscription
                    </button>

                    <button type="button" class="btn btn-outline-secondary action-btn" (click)="resetForm()"
                        [disabled]="isLoading">
                        {{ selectedSubscriptionId ? 'Cancel' : 'Reset Form' }}
                    </button>
                </div>
            </div>

            <div *ngIf="errorMessage" class="alert alert-danger error-message">
                <mat-icon>error_outline</mat-icon>
                <span>{{ errorMessage }}</span>
            </div>
        </form>

        <div class="subscription-list" *ngIf="hasSubscriptions">
            <div class="list-header">Your Electricity Subscriptions</div>
            <ul class="subscription-items">
                <li *ngFor="let s of subscriptions" (click)="selectSubscriptionToEdit(s)" class="subscription-item"
                    [class.selected]="selectedSubscriptionId === s.subscriptionId">
                    <div class="subscription-content">
                        <div class="subscription-title">
                            {{ getSubServiceName(s.subServiceId ?? 0) }}
                        </div>
                        <div class="subscription-details">
                            <span>{{ getFormattedDate(s.startDate ?? 0) }}</span>
                            <span>‚Üí</span>
                            <span>{{ getFormattedDate(s.endDate ?? 0) }}</span>
                            <span>({{ s.discount }}% discount)</span>
                        </div>
                    </div>
                    <span class="arrow">‚Ä∫</span>
                </li>
            </ul>
        </div>


    </div>
</div>
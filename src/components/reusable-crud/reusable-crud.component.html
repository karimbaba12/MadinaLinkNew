<div class="crud-container">
    <!-- Header Section -->
    <div class="crud-header">
        <div class="header-content">
            <div class="title-section">
                <h2 class="title">{{ config.title || 'Data Management' }}</h2>
                <span class="subtitle" *ngIf="config.subtitle">{{ config.subtitle }}</span>
            </div>

            <div class="controls-section">

                <mat-form-field appearance="outline" class="search-field" *ngIf="showSearch">
                    <mat-label>{{ searchPlaceholder }}</mat-label>
                    <input matInput [formControl]="searchControl" [placeholder]="searchPlaceholder">
                    <button mat-icon-button matSuffix *ngIf="searchControl.value" (click)="clearSearch()">
                        <mat-icon>close</mat-icon>
                    </button>
                    <mat-icon matSuffix *ngIf="!searchControl.value">search</mat-icon>
                </mat-form-field>

                <div class="action-buttons">
                    <button mat-stroked-button (click)="refresh.emit()" class="action-button btn btn-secondary">
                        <mat-icon>refresh</mat-icon>
                        <span>Refresh</span>
                    </button>
                    <button mat-raised-button color="primary" (click)="add.emit()"
                        class="action-button btn btn-success">
                        <mat-icon>add</mat-icon>
                        <span>Add New</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="isLoading">
        <div class="loading-content">
            <mat-spinner diameter="50"></mat-spinner>
            <span class="loading-text">Loading data...</span>
        </div>
    </div>

    <!-- Data Table -->
    <div class="table-wrapper" *ngIf="!isLoading">
        <div class="table-container">
            <table mat-table [dataSource]="config.dataSource || []" matSort (matSortChange)="onSortChange($event)"
                class="data-table" [class.with-actions]="rowActionsTemplate">

                <!-- Dynamic Columns -->
                <ng-container *ngFor="let column of config?.columns || []" [matColumnDef]="column.name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!column.sortable"
                        [class.numeric]="column.numeric" class="header-cell">
                        {{ column.header }}

                    </th>
                    <td mat-cell *matCellDef="let row" [class.numeric]="column.numeric" class="data-cell">
                        <ng-container *ngIf="!columnTemplates[column.name]; else customTemplate">
                            <span class="cell-content">{{ getCellValue(row, column) }}</span>
                        </ng-container>
                        <ng-template #customTemplate>
                            <ng-container
                                *ngTemplateOutlet="columnTemplates[column.name]; context: { $implicit: row }"></ng-container>
                        </ng-template>
                    </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions" *ngIf="rowActionsTemplate">
                    <th mat-header-cell *matHeaderCellDef class="actions-header">Actions</th>
                    <td mat-cell *matCellDef="let row" class="actions-cell">
                        <div class="actions-container">
                            <ng-container
                                *ngTemplateOutlet="rowActionsTemplate; context: { $implicit: row }"></ng-container>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns" class="header-row"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="onRowClick(row)" class="data-row">
                </tr>
            </table>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="config.dataSource.length === 0">
                <mat-icon class="empty-icon">inbox</mat-icon>
                <h3>No data available</h3>
                <p>There are no records to display</p>
                <button mat-raised-button color="primary" (click)="add.emit()" *ngIf="rowActionsTemplate">
                    <mat-icon>add</mat-icon>
                    Create First Record
                </button>
            </div>
        </div>

        <!-- Pagination -->
        <mat-paginator [length]="config.totalItems || config.dataSource.length || 0" [pageSize]="config.pageSize || 10"
            [pageSizeOptions]="[5, 10, 25, 100]" (page)="handlePageChange($event)" class="paginator">
        </mat-paginator>
    </div>
</div>